基于 Hadoop 云 计算 家居 平台 近年来 ， 在 物 联网 等 具有 海量 数据 需求 的 应用 变得 越来越 普遍 时 ， 无论是 从 科学研究 还是 从 应用 开发 的 角度 来看 ， 掌握 云 计算技术 已 成为 一种 趋势 。 智能家居 作为 物 联网 应用 的 主要 领域 之一 ， 自然 离不开 云 计算 。 云 计算 的 发展 使 用户 无需 关注 复杂 的 内部 工作 机制 、 无需 具备 丰富 的 分布式系统 知识 及 开发 经验 ， 即可 实现 大规模 分布式系统 规定 部署 ， 以及 海量 数据 的 并行处理 。 　 　 Hadoop 是 目前 较为 成熟 和 应用 较为 广泛 的 云 计算 架构 之一 。 Hadoop 的 核心思想 是 分布式 并行处理 。 Hadoop 技术 中 的 关键技术 是 HDFS ( 分布式文件系统 ) 和 Map / Reduce ( 映射 / 规约 ) 。 Hadoop 利用 HDFS 存储 海量 数据 ， 利用 Map / Reduce 进行 海量 数据 的 计算 。 　 　 文中 首先 介绍 了 智能家居 与 云 计算 的 概念 ， 接着 针对 传统 的 海量 数据处理 方法 硬件 成本 太高 ， 存在 计算 瓶颈 的 问题 ， 在 云 计算 理论 的 基础 上 针对 智能家居 中 的 门禁系统 、 温湿度 系统 、 滴灌 系统 和 照明 系统 搭建 了 基于 Hadoop 的 数据处理 平台 。 可以 对 大量 传感 信息 进行 分布式 并行处理 ， 并 根据 处理结果 向 底层 设备 发送 指令 以 实现 智慧 化 服务 。 　 　 智能家居 与 云 计算 　 　 1.1 智能家居 　 　 目前 通常 把 智能家居 定义 为 利用 电脑 、 网络 和 综合 布线 技术 ， 通过 家庭 信息管理 平台 将 与 家居生活 有关 的 各种 子系统 有机 结合 的 一个 系统 。 首先 ， 需要 在 家居 中 建立 一个 通信 网络 ， 为 家庭 信息 交互 和 传输 提供 必要 的 通路 ， 在 家庭网络 的 操作系统 控制 下 ， 通过 相应 的 硬件 和 执行机构 ， 实现 对 所有 家庭网络 上 的 家电 和 设备 的 控制 和 监测 。 其次 ， 智能家居 系统 需要 通过 一定 的 媒介 平台 ， 提供 与 外界 的 通信 通道 ， 以 实现 与 家庭 以外 的 世界 沟通 信息 ， 满足 远程 控制 / 监测 和 交换 信息 的 需求 。 　 　 1.2 云 计算 架构 Hadoop 　 　 Hadoop 是 一个 分布式计算 框架 ， 可以 在 大量 廉价 的 硬件 设备 组成 的 集群 上 运行 应用程序 ， 为 应用程序 提供 了 一组 稳定 可靠 的 接口 ， 旨在 构建 一个 具有 高可靠性 和 良好 扩展性 的 分布式系统 。 Hadoop 的 主要 优点 有 ： 扩容 能力 强 、 成本 低廉 、 效率高 、 可靠性 高 、 免费 开源 及 良好 的 可移植性 。 Hadoop 项目 包括 多个 子项目 ， 但 主要 是 由 Hadoop 分布式文件系统 ( HadoopDistributed   File   System ，   HDFS ) 和 映射 / 规约 引擎 ( Map / Reduce   Engine ) 两个 主要 的 子项目 构成 。 　 　 1.3 分布式 " 文件系统 ( HDFS ) 　 　 HDFS 由 一个 名叫 NameNode 的 主 节点 和 多个 名叫 DataNode 的 子 节点 组成 ， 是 一种 典型 的 主从 式 ( Master \ / Slave ) 架构 ， 这种 架构 方法 可以 通过 主 节点 屏蔽 底层 的 复杂 结构 ， 并 向 Client 提供方便 的 文件目录 映射 。 NameNode 存储 着 文件系统 的 元 数据 ， 这些 元 数据 包括 文件系统 的 名字 空间 等 ， 并 负责 管理文件 的 存储 等 服务 ， 但 实际 的 数据 并 不 存放 在 NameNode ， 而是 由 HDFS 中 的 DataNode 来 存放数据 ， 然后 由 Client 直接 与 DataNode 建立 数据通信 。 　 　 此外 ， HDFS 为了 可靠 地 海量 存储 文件 ， 各个 文件 以块 序列 的 形式 存储 。 为了 保证 故障 容错 ， 文件 的 块 被 复制 。 块 的 大小 和 副本 的 个数 都 可以 配置 。 Name 鄄 Node 控制 所有 的 块 复制 操作 ， 它 周期性地 接收 来自 集群 中 DataNode 的 “ 心跳 冶 回应 和 块 报告 。 收到 一个 节点 的 “ 心跳 冶 回应 表示 这个 DataNode 是 正常 的 。 　 　 1.4 MapReduce 分布式计算 　 　 MapReduce 分布式计算 主要 是 用来 在 数千 部 服务器 上 同时 处理 保存 于 GFS   Clusters 中高达 几十 TB 甚至 更 多 的 数据 。 　 　 MapReduce 在 温度 值 统计 过程 中 的 运作 如下 所述 。 　 　 MapReduce 的 作用 是 对 计算机 集群 上 的 大型 数据 集 运行 分布式计算 ， 替 大量 数据 做 平行 计算 处理 。 MapReduce 的 整个 架构 是 由 Map 和 Reduce 函数 组成 的 ， 当 程序 输入 一大 组 Key \ / Value 键值 对时 ， Map 函数 自动 将 原本 的 Key \ / Value 分拆 成 多组 中介 的 键值 对 ， 然后 Reduce 函数 再 合并 具有 相同 Key 的 中介 值 配对 ， 化简 成 最后 的 输出 结果 。 　 　 1.5 智能家居 云 模型 　 　 智能家居 拥有 7 大 子系统 ， 每 一个 系统 包含 了 不同 的 终端 ， 每 一个 终端 都 安装 有 传感器 ， 传感器 感知 周围环境 并 产生 大量 数据 。 千千万万 的 用户 会 产生 海量 的 数据 ， 而云 计算 可靠 的 数据 存储 ， 强大 的 计算能力 ， 低廉 的 运营 成本 使得 它 非常适合 处理 海量 数据 。 于是 每家 用户 都 将 通过 网络连接 到 云 服务中心 ， 产生 的 数据 均 由 云 计算中心 存储 和 计算 处理 。 　 　 开发 程序设计 分析 　 　 本 平台 针对 智能家居 中 的 几个 典型 应用 ： 门禁 、 温度 、 湿度 、 光照 等 进行 信息 采集 及 分布式 并行处理 。 启动 程序 后 可以 看到 当前 房间内 的 温度 、 湿度 、 土壤湿度 、 光 强度 ， 还 可以 通过 对 室内 温度 、 湿度 、 土壤湿度 进行 设定 来 改变 当前 的 状态 。 　 　 2.1 功能模块 设计 　 　 根据 需求 分析 可知 ， 系统 功能模块 共 分为 四大 部分 ， 即 门禁系统 、 温湿度 系统 、 滴灌 系统 、 照明 系统 。 　 　 门禁系统 实现 的 功能 是 持卡人 刷卡 ， 产生 持卡人 的 卡号 ， 从事 先 设定 好 的 数据库 中 查询 是否 有 该 卡号 ， 如果 有 说明 该 用户 为 合法 用户 ， 门禁 打开 ， 并 显示 持卡人 卡号 、 姓名 、 卡 的 类型 ， 否则 门禁 继续 保持 关闭 。 　 　 温湿度 系统 显示 室内 当前 温度 和 湿度 。 当 设定 一个 温度 值后 ， 空调 工作 ， 根据 设定 温度 调整 室内 温度 ， 直到 室内 当前 温度 达到 设定值 ； 当 设定 湿度 值后 ， 室内 湿度 就 会 根据 所 设定 的 湿度 进行 调整 ， 直到 室内 当前 湿度 达到 设定值 。 　 　 滴灌 系统 显示 当前 的 土壤湿度 。 当 设定 土壤湿度 后 ， 滴灌 系统 工作 ， 调整 湿度 直到 当前 湿度 为 设定 的 土壤湿度 。 　 　 在 照明 系统 中 ， 显示 室内 当前 光 强度 。 窗帘 和 电灯 的 状态 受控 于 光照强度 的 大小 。 　 　 智能家居 云 计算 平台 实现 的 功能 主要 是 能够 将 产生 的 传感 信息 集中 交给 服务器 处理 ， 用户 只 需 将 传感器 采集 来 的 传感 信息 传输 给 服务器 即可 。 服务器 为 计算机 集群 ， 这里 使用 三台 电脑 进行 模拟 。 三台 电脑 对 信息 进行 分布式 并行处理 ， 并 根据 处理结果 对 底层 设备 发出 指令 ， 以 达到 智能 控制 的 效果 。 同时 还要 将 各种 传感 数据 和 底层 设备 的 状态 写入 数据库 。 　 　 2.2 逻辑 结构设计 　 　 ( 1 ) 门禁系统 。 　 　 门禁 状态 一 开始 为 关闭 。 当 持卡人 来 刷卡 时 ， 获得 持卡人 卡号 ， 查询数据库 ， 判断 卡 的 ID 是否 合法 ， 如果 ID 不 合法 ， 则 门禁 保持 关闭 状态 。 如果 合法 则 门禁 打开 ， 并且 显示 持卡人 的 姓名 和 性别 。 　 　 ( 2 ) 温湿度 系统 。 　 　 系统启动 时 首先 要 对 温度 进行 判断 。 当前 温度 低于 下 限值 ， 空调 启动 制热 ； 当前 温度 高于 上 限值 ， 空调 启动 制冷 ； 当 室内 当前 温度 调整 到 舒适 范围 时 空调 自动 关闭 。 系统 同时 显示 室内 当前 湿度 ， 通过 “ 设定 湿度 冶 按钮 可以 设置 室内 湿度 ， 当前 湿度 会 慢慢 调整 到 所 设置 的 湿度 。 　 　 ( 3 ) 室内 滴灌 系统 。 　 　 滴灌 系统 的 状态 主要 受控 于 土壤湿度 。 这里 土壤湿度 依然 采用 相对湿度 。 　 　 系统 开始运行 时 滴灌 处于 关闭 状态 ， 然后 判断 土壤湿度 是否 小于 0.15 ， 如果 小于 0.15 ， 滴灌 打开 ， 喷水 ， 土壤湿度 开始 上升 ， 当 土壤湿度 达到 预先 设定 的 上 限值 时 ( 0.4 ) ， 滴灌 自动 关闭 。 滴灌 关闭 后 由于 水分 的 蒸发 ， 土壤湿度 会 逐渐 减少 。 系统 每隔 1s 对 土壤湿度 进行 一次 判断 ， 如果 土壤湿度 少于 0.15 ， 则 滴灌 再次 打开 。 如此 反复 。 当然 ， 土壤湿度 的 上 限值 也 可以 通过 “ 设定 土湿冶 按钮 进行 设定 。 　 　 ( 4 ) 照明 系统 。 　 　 照明 系统 主要 由 窗帘 和 电灯 两个 部分 组成 。 窗帘 和 电灯 的 状态 会 根据 光照强度 的 大小 以及 当前 时间 自动 改变 。 根据 文献 [ 1 ] 将 客厅 照明 的 最低 照明 度 定为 临界值 ， 即 150Lux 。 　 　 ( 5 ) 智能家居 云 平台 。 　 　 整个 云 平台 采用 五台 电脑 进行 模拟 ， 第一台 电脑 作为 传感器 和 底层 设备 的 模拟 ， 用于 产生 传感 信息 。 第二台 电脑 作为 连接 底层 设备 和 服务器 的 网关 ， 剩下 三台 电脑 构成 服务器 集群 ， 作为 云 处理 中心 ， 并 与 数据库 相连 ， 对 传感 信息 进行 分布式 并行处理 。 服务器 与 客户端 之间 的 通信 使用 Socket 。 　 　 平台 仿真 　 　 3.1 门禁系统 测试 　 　 运行 程序 后 ， 门禁 处于 关闭 状态 。 单击 “ 生成 ID 冶 按钮 ， 会 产生 当前 持卡人 卡 的 ID 号 。 然后 单击 “ 刷卡 搜索 数据库 中 已 存在 的 合法 ID 号 ， 合法 来访者 ， 门禁 打开 ， 并 显示 持卡人 的 姓名 和 性别 。 门禁 打开 5s 后 再次 关上 。 如果 ID 号 不 存在 ， 则 门禁 继续 保持 关闭 状态 ， 如图 4 所示 。 　 　 3.2 温湿度 系统 测试 　 　 运行 程序 后 显示 当前 温度 、 湿度 ， 以及 默认 的 下限 温度 ( 18 益 ) 和 上限 温度 ( 23 益 ) 。 系统 将 当前 温度 与 下限 温度 和 上限 温度 进行 比较 ， 如果 当前 温度 在 人体 舒适度 范围 18 益 ~ 23 益内 ， 则 空调 继续 保持 关闭 状态 。 当前 室内 温度 低于 下限 温度 时 ， 空调 打开 ， 处于 制热 状态 ， 直到 当前 室内 温度 达到 舒适度 的 下限 温度 。 当前 室内 温度 高于 上限 温度 时 ， 空调 打开 ， 处于 制冷 状态 ， 直到 当前 室内 温度 达到 舒适度 的 上限 温度 。 温度 的 上下 限值 可以 通过 设置 按钮 进行 设定 。 　 　 在 “ 设定 湿度 冶旁 的 文本框 中 输入 所 要 设置 的 室内 湿度 ， 然后 按 “ 设定 湿度 冶 按钮 ， 这时 室内 的 温度 就 会 慢慢 改变 ， 上升 或 下降 ， 直到 当前 湿度 达到 所 设定 的 湿度 。 　 　 3.3 滴灌 系统 测试 　 　 运行 程序 后 显示 当前 土壤湿度 ， 滴灌 系统 一 开始 处于 关闭 状态 。 由于 土壤 中 水分 的 蒸发 ， 土壤湿度 不断 下降 。 当 土壤湿度 降到 0.15 时 滴灌 自动 打开 ， 开始 喷水 。 滴灌 喷水 后 土壤湿度 增加 ， 直到 当前 土壤湿度 达到 设定值 ( 默认值 为 0.4 ) ， 这时 滴灌 再次 关闭 。 　 　 3.4 照明 系统 测试 　 　 运行 程序 后 显示 当前 的 室内 光 强度 ， 如果 是 早晨 七点 到 晚上 六点 ， 则 窗帘 打开 ， 其他 时间段 窗帘 关闭 。 电灯 的 状态 不仅 受 时间段 控制 ， 也 受 室内 光 强度 控制 。 如果 是 晚上 十点 到 第二天 早晨 七点 ， 电灯 处于 关闭 状态 。 在 早晨 七点 到 晚上 六点 之间 ， 电灯 一般 是 关闭 状态 ， 除非 室内 自然光 强度 低于 150Lux ， 晚上 六点 到 晚上 十点 ， 电灯 是 打开 状态 的 。 　 　 3.5 云 平台 测试 　 　 将 五台 电脑 建立 连接 并 启动 ， 第一台 电脑 用于 模拟 传感器 和 底层 设备 ， 第二台 电脑 作为 连接 底层 网络 和 上层 网络 的 网关 ， 剩下 三台 电脑 作为 服务器 集群 ( 云 计算中心 ) 。 第一台 电脑 产生 传感 数据 后 传给 第二台 电脑 ， 第二台 电脑 作为 网关 将 数据 转发给 服务器 集群 ， 服务器 集群 采用 Hadoop 计算 架构 对 传感 数据 进行 分布式 并行处理 ， 判断 当前 智能家居 各 系统 的 状态 ， 并 发出 指令 给 底层 设备 ， 达到 智能 控制 的 效果 。 　 　 结束语 　 　 文中 在 云 计算 理论 的 基础 上 针对 智能家居 中 的 门禁系统 、 温湿度 系统 、 滴灌 系统 和 照明 系统 搭建 了 基于 Hadoop 的 数据处理 平台 。 可以 对 大量 传感 信息 进行 分布式 并行处理 ， 并 根据 处理结果 向 底层 设备 发送 指令 以 实现 智慧 化 服务 。 此云 计算 平台 是 在 Hadoop 分布式计算 框架 的 基础 上 采用 三台 电脑 模拟 服务器 集群 实现 对 海量 数据 的 并行处理 ， 有效 解决 了 成本 和 计算 瓶颈 问题 。